<style>
    .container {
        max-width: 90%;
    }
</style>
<% layout('/layouts/boilerplate') %>
    <% const seg=program.seg %>

        <div class="row px-auto">
            <div class="col mb-3">
                <a id="backToSegButton" class="btn btn-primary" href="/plant/<%= currentPlant._id %>/seg/<%= seg.segInstruction._id %>">Back to <%=seg.segInstruction.segInstructionID %></a>
                <form action="/plant/<%= currentPlant._id %>/seg/<%= seg.segInstruction._id %>/conclusion/<%= program._id %>?_method=PUT"
                    method="post">
                    <div class="my-3">
                        <h1 class="fs-3 d-inline">
                            <%=seg.segInstruction.segInstructionID %>, <%=program.name %>, Conclusion
                        </h1>
                        <button id="saveTextButton" class="btn btn-success d-inline">Save</button>
                    </div>

                    <textarea class="form-control"
                        name="conclusion"><%= program.conclusion[0] !== '' ? program.conclusion[0] : '' %></textarea>
                </form>
            </div>
        </div>



            <!-- NicEdit -->
            <script src="/js/nicEdit.js" type="text/javascript"></script>
            <script type="text/javascript">bkLib.onDomLoaded(nicEditors.allTextAreas);</script> 
            <script>
                document.addEventListener('DOMContentLoaded', () => {
                    const editors = document.querySelectorAll('div.nicEdit-main').forEach((element, i) => {
                        element.setAttribute('style', 'width: 100%'); // Add width property
                        element.setAttribute('style', 'min-height: 300px;'); // Add height property
                    });
                });
            </script>
            
            <script>
                let originalText;
                document.addEventListener('DOMContentLoaded', () => {
                    if (document.querySelector('.nicEdit-main')) {
                        originalText = document.querySelector('.nicEdit-main').innerHTML;
                    }
                })
            </script>

            <script>
                window.addEventListener('beforeunload', (e) => {
                    let newText = document.querySelector('.nicEdit-main').innerHTML;
                    if (newText !== originalText && e.target.activeElement.id !== 'saveTextButton') {
                        e.preventDefault();
                    }
                })
            </script>